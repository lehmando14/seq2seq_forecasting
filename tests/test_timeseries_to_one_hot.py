import numpy as np

from preprocessing import timeseries_to_one_hot as oh


def test_two_features():

    users_trans_ts =  np.array([
                            [[1, 0], [2, 1], [0, 51]],
                            [[0, 0], [0, 1], [0, 49]]])
    
    target_array = np.array([
                        [[0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]],
                        
                        [[1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]]])

    output_array = oh.time_series_to_one_hot(users_trans_ts, 2)

    assert np.array_equal(output_array, target_array)

# I'm only using weeks and transactions now
# def test_three_features():
#     users_trans_ts =  np.array([
#                             [[3, 0, 1], [0, 1, 1], [0, 2, 1], [0, 3, 1], [0, 4, 1]],
#                             [[0, 0, 2], [0, 1, 2], [4, 2, 2], [1, 3, 2], [0, 4, 2]]])
    
#     target_array = np.array([[[0, 0, 0, 1, 0, 0, 1],
#                           [1, 0, 0, 0, 0, 1, 1],
#                           [1, 0, 0, 0, 0, 2, 1],
#                           [1, 0, 0, 0, 0, 3, 1],
#                           [1, 0, 0, 0, 0, 4, 1]],

#                          [[1, 0, 0, 0, 0, 0, 2],
#                           [1, 0, 0, 0, 0, 1, 2],
#                           [0, 0, 0, 0, 1, 2, 2],
#                           [0, 1, 0, 0, 0, 3, 2],
#                           [1, 0, 0, 0, 0, 4, 2]]])

#     output_array = oh.time_series_to_one_hot(users_trans_ts, 4)

#     assert np.array_equal(output_array, target_array)